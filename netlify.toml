[build]
  command = "npm run build && npm run build:server"
  publish = "build"

# IMPORTANT: Order matters! More specific rules must come first
# Static assets should be served directly (not through SSR function)
[[redirects]]
  from = "/static/*"
  to = "/static/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/*.js"
  to = "/:splat.js"
  status = 200
  force = true

[[redirects]]
  from = "/*.css"
  to = "/:splat.css"
  status = 200
  force = true

[[redirects]]
  from = "/*.ico"
  to = "/:splat.ico"
  status = 200
  force = true

[[redirects]]
  from = "/*.png"
  to = "/:splat.png"
  status = 200
  force = true

[[redirects]]
  from = "/*.jpg"
  to = "/:splat.jpg"
  status = 200
  force = true

[[redirects]]
  from = "/*.svg"
  to = "/:splat.svg"
  status = 200
  force = true

[[redirects]]
  from = "/*.json"
  to = "/:splat.json"
  status = 200
  force = true

[[redirects]]
  from = "/*.txt"
  to = "/:splat.txt"
  status = 200
  force = true

[[redirects]]
  from = "/*.webmanifest"
  to = "/:splat.webmanifest"
  status = 200
  force = true

# Redirect ALL other requests to SSR function (this catches HTML pages)
# This must be last to catch everything else
[[redirects]]
  from = "/*"
  to = "/.netlify/functions/ssr"
  status = 200
  force = false

[functions]
  node_bundler = "esbuild"
  included_files = ["build/**"]

